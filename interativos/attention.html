<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠 Mecanismo de Atenção - Guia Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .back-button {
            position: absolute;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .learning-path {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .path-step {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 150px;
        }
        
        .path-step:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .path-step.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }
        
        .step-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .step-title {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            align-items: start;
        }
        
        @media (max-width: 1024px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .range-input {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        
        .param-group {
            margin-bottom: 15px;
        }
        
        .param-label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: block;
        }
        
        .param-value {
            font-weight: bold;
            color: #60a5fa;
            margin-left: 10px;
        }
        
        .param-hint {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .token-item {
            display: inline-block;
            padding: 8px 16px;
            margin: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .token-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .token-item.selected {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }
        
        .attention-matrix {
            display: grid;
            gap: 2px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .attention-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .attention-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .matrix-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .vector-visualization {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }
        
        .vector-component {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        
        .attention-flow {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flow-bars {
            display: flex;
            align-items: end;
            gap: 10px;
            height: 150px;
        }
        
        .flow-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .bar {
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            border-radius: 4px 4px 0 0;
            width: 25px;
            transition: all 0.3s ease;
        }
        
        .bar-label {
            font-size: 12px;
            text-align: center;
            opacity: 0.8;
        }
        
        .bar-value {
            font-size: 11px;
            font-weight: bold;
            color: #60a5fa;
        }
        
        .explanation-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 0 15px 15px 0;
            margin: 20px 0;
        }
        
        .explanation-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #60a5fa;
        }
        
        .math-formula {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .concept-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .concept-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }
        
        .concept-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .concept-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #60a5fa;
        }
        
        .interactive-demo {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .demo-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .empty-state {
            text-align: center;
            opacity: 0.6;
            padding: 40px 20px;
            font-style: italic;
        }
        
        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .progress-dot.active {
            background: #3b82f6;
            transform: scale(1.2);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="page-header">
            <a href="index.html" class="back-button">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Voltar
            </a>
            
            <h1 class="page-title">🧠 Mecanismo de Atenção</h1>
            <p class="page-subtitle">Guia Completo: Da Teoria à Prática</p>
            
            <div class="learning-path">
                <div class="path-step active" data-step="1">
                    <div class="step-number">1️⃣</div>
                    <div class="step-title">Conceitos Básicos</div>
                </div>
                <div class="path-step" data-step="2">
                    <div class="step-number">2️⃣</div>
                    <div class="step-title">Matemática</div>
                </div>
                <div class="path-step" data-step="3">
                    <div class="step-number">3️⃣</div>
                    <div class="step-title">Visualização</div>
                </div>
                <div class="path-step" data-step="4">
                    <div class="step-number">4️⃣</div>
                    <div class="step-title">Tipos de Atenção</div>
                </div>
                <div class="path-step" data-step="5">
                    <div class="step-number">5️⃣</div>
                    <div class="step-title">Prática</div>
                </div>
            </div>
        </header>

        <!-- Seção 1: Conceitos Básicos -->
        <div class="content-section active" id="section-1">
            <div class="glass-card">
                <h2 class="section-title">🎯 O que é Atenção?</h2>
                
                <div class="explanation-box">
                    <div class="explanation-title">💡 Analogia do Mundo Real</div>
                    <p>Imagine que você está em uma festa barulhenta, mas consegue focar na conversa com seu amigo. Seu cérebro está "prestando atenção" à voz dele, filtrando outros ruídos. O mecanismo de atenção em IA funciona de forma similar!</p>
                </div>
                
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-icon">🔍</div>
                        <div class="concept-title">Foco Seletivo</div>
                        <p>A atenção permite que o modelo foque nas partes mais relevantes da entrada, ignorando informações menos importantes.</p>
                    </div>
                    
                    <div class="concept-card">
                        <div class="concept-icon">🔗</div>
                        <div class="concept-title">Conexões Dinâmicas</div>
                        <p>Cada palavra pode se relacionar com qualquer outra palavra, criando conexões dinâmicas baseadas no contexto.</p>
                    </div>
                    
                    <div class="concept-card">
                        <div class="concept-icon">⚖️</div>
                        <div class="concept-title">Pesos Adaptativos</div>
                        <p>O modelo aprende automaticamente quais conexões são mais importantes para cada situação específica.</p>
                    </div>
                </div>
                
                <div class="interactive-demo">
                    <h3>🎮 Demonstração Interativa</h3>
                    <p>Clique nas palavras abaixo para ver como elas se relacionam:</p>
                    <div id="basicDemo" class="demo-area">
                        <div class="token-item" data-word="O">O</div>
                        <div class="token-item" data-word="gato">gato</div>
                        <div class="token-item" data-word="subiu">subiu</div>
                        <div class="token-item" data-word="no">no</div>
                        <div class="token-item" data-word="telhado">telhado</div>
                    </div>
                    <div id="basicExplanation" class="explanation-box" style="display: none;">
                        <div class="explanation-title">Análise da Conexão</div>
                        <p id="connectionText"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção 2: Matemática -->
        <div class="content-section" id="section-2">
            <div class="glass-card">
                <h2 class="section-title">🧮 A Matemática por Trás da Atenção</h2>
                
                <div class="explanation-box">
                    <div class="explanation-title">📐 Fórmula Fundamental</div>
                    <p>O mecanismo de atenção pode ser resumido em uma fórmula elegante:</p>
                    <div class="math-formula">
                        Attention(Q, K, V) = softmax(QK^T / √d_k)V
                    </div>
                    <p>Onde:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Q</strong> = Query (consulta) - "O que estou procurando?"</li>
                        <li><strong>K</strong> = Key (chave) - "O que está disponível?"</li>
                        <li><strong>V</strong> = Value (valor) - "Qual informação vou usar?"</li>
                        <li><strong>d_k</strong> = Dimensão das chaves (para normalização)</li>
                    </ul>
                </div>
                
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-icon">🔎</div>
                        <div class="concept-title">Query (Q)</div>
                        <p>Representa "o que estamos procurando". É como fazer uma pergunta: "Que informação preciso para entender esta palavra?"</p>
                        <div class="math-formula">Q = X × W_Q</div>
                    </div>
                    
                    <div class="concept-card">
                        <div class="concept-icon">🔑</div>
                        <div class="concept-title">Key (K)</div>
                        <p>Representa "o que está disponível". São as "etiquetas" de cada posição que podem ser consultadas.</p>
                        <div class="math-formula">K = X × W_K</div>
                    </div>
                    
                    <div class="concept-card">
                        <div class="concept-icon">💎</div>
                        <div class="concept-title">Value (V)</div>
                        <p>Representa "a informação real". É o conteúdo que será usado quando uma posição receber atenção.</p>
                        <div class="math-formula">V = X × W_V</div>
                    </div>
                </div>
                
                <div class="interactive-demo">
                    <h3>🎯 Calculadora de Atenção</h3>
                    <div class="demo-controls">
                        <button class="btn btn-secondary" onclick="generateRandomVectors()">🎲 Gerar Vetores Aleatórios</button>
                        <button class="btn btn-primary" onclick="calculateAttentionStep()">➡️ Próximo Passo</button>
                        <button class="btn btn-secondary" onclick="resetCalculation()">🔄 Reiniciar</button>
                    </div>
                    <div id="mathVisualization">
                        <div class="empty-state">Clique em "Gerar Vetores Aleatórios" para começar</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção 3: Visualização -->
        <div class="content-section" id="section-3">
            <div class="grid-layout">
                <div class="control-panel">
                    <div class="form-group">
                        <label class="form-label">📝 Texto para Análise</label>
                        <textarea id="inputText" class="form-input form-textarea" placeholder="Digite uma frase para analisar...">O gato subiu no telhado</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">⚙️ Configurações</label>
                        <div class="param-group">
                            <label class="param-label">📐 Dimensão do Modelo</label>
                            <input type="range" id="modelDim" min="64" max="512" step="64" value="256" class="range-input">
                            <span id="modelDimValue" class="param-value">256 dimensões</span>
                        </div>
                        <div class="param-group">
                            <label class="param-label">🎯 Temperatura</label>
                            <input type="range" id="temperature" min="0.1" max="2" step="0.1" value="1" class="range-input">
                            <span id="temperatureValue" class="param-value">1.0</span>
                        </div>
                    </div>
                    
                    <button id="analyzeButton" class="btn btn-primary" style="width: 100%;">🚀 Analisar Atenção</button>
                </div>
                
                <div>
                    <div class="glass-card">
                        <h2 class="section-title">🔤 Tokens</h2>
                        <div id="tokensDisplay">
                            <div class="empty-state">Os tokens aparecerão aqui após a análise</div>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h2 class="section-title">🎯 Matriz de Atenção</h2>
                        <div id="attentionMatrixContainer">
                            <div class="empty-state">A matriz de atenção aparecerá aqui</div>
                        </div>
                        <div class="explanation-box">
                            <div class="explanation-title">📖 Como Interpretar</div>
                            <p><strong>Linhas:</strong> Token que está "prestando atenção"</p>
                            <p><strong>Colunas:</strong> Token que está "recebendo atenção"</p>
                            <p><strong>Cores:</strong> Intensidade da atenção (azul claro = baixa, azul escuro = alta)</p>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h2 class="section-title">🌊 Fluxo de Atenção</h2>
                        <div id="attentionFlow">
                            <div class="empty-state">Clique em um token para ver seu fluxo de atenção</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção 4: Tipos de Atenção -->
        <div class="content-section" id="section-4">
            <div class="glass-card">
                <h2 class="section-title">🎭 Tipos de Atenção</h2>
                
                <div class="concept-grid">
                    <div class="concept-card" onclick="selectAttentionType('self')">
                        <div class="concept-icon">🔄</div>
                        <div class="concept-title">Self-Attention</div>
                        <p>Cada token presta atenção a todos os outros tokens na mesma sequência. Usado em BERT e na parte encoder do Transformer.</p>
                        <div class="math-formula">Bidirectional</div>
                    </div>
                    
                    <div class="concept-card" onclick="selectAttentionType('masked')">
                        <div class="concept-icon">🎭</div>
                        <div class="concept-title">Masked Self-Attention</div>
                        <p>Cada token só pode prestar atenção aos tokens anteriores. Usado em GPT para geração de texto.</p>
                        <div class="math-formula">Causal/Autoregressive</div>
                    </div>
                    
                    <div class="concept-card" onclick="selectAttentionType('cross')">
                        <div class="concept-icon">🔀</div>
                        <div class="concept-title">Cross-Attention</div>
                        <p>Tokens de uma sequência prestam atenção a tokens de outra sequência. Usado em tradução e no decoder do Transformer.</p>
                        <div class="math-formula">Encoder-Decoder</div>
                    </div>
                </div>
                
                <div id="attentionTypeDemo" class="interactive-demo">
                    <h3 id="demoTitle">🔄 Self-Attention</h3>
                    <div id="typeVisualization">
                        <div class="empty-state">Selecione um tipo de atenção acima para ver a demonstração</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção 5: Prática -->
        <div class="content-section" id="section-5">
            <div class="glass-card">
                <h2 class="section-title">🛠️ Laboratório Prático</h2>
                
                <div class="interactive-demo">
                    <h3>🧪 Experimente Diferentes Cenários</h3>
                    
                    <div class="demo-controls">
                        <button class="btn btn-secondary" onclick="loadExample('simple')">📝 Frase Simples</button>
                        <button class="btn btn-secondary" onclick="loadExample('complex')">🧩 Frase Complexa</button>
                        <button class="btn btn-secondary" onclick="loadExample('ambiguous')">❓ Frase Ambígua</button>
                        <button class="btn btn-secondary" onclick="loadExample('long')">📚 Texto Longo</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">✏️ Ou digite seu próprio texto:</label>
                        <textarea id="practiceText" class="form-input form-textarea" placeholder="Digite aqui para experimentar..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">🎛️ Configurações Avançadas</label>
                        <div class="param-group">
                            <label class="param-label">🧠 Número de Cabeças</label>
                            <input type="range" id="numHeads" min="1" max="12" value="8" class="range-input">
                            <span id="numHeadsValue" class="param-value">8 cabeças</span>
                        </div>
                        <div class="param-group">
                            <label class="param-label">🎯 Tipo de Atenção</label>
                            <select id="attentionTypeSelect" class="form-input">
                                <option value="self">Self-Attention</option>
                                <option value="masked">Masked Self-Attention</option>
                                <option value="cross">Cross-Attention</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="runExperiment" class="btn btn-primary" style="width: 100%;">🚀 Executar Experimento</button>
                </div>
                
                <div id="experimentResults" class="glass-card" style="display: none; margin-top: 20px;">
                    <h3>📊 Resultados do Experimento</h3>
                    <div id="resultsContent"></div>
                </div>
            </div>
            
            <div class="glass-card">
                <h2 class="section-title">💻 Implementação em Rust</h2>
                
                <div class="explanation-box">
                    <div class="explanation-title">🦀 Código de Exemplo</div>
                    <p>Aqui está como implementar atenção básica em Rust:</p>
                </div>
                
                <div class="math-formula">
<pre style="color: #e2e8f0; line-height: 1.5;">
use ndarray::{Array2, Axis};
use ndarray_linalg::Norm;

struct AttentionLayer {
    d_model: usize,
    d_k: usize,
    w_q: Array2&lt;f32&gt;,
    w_k: Array2&lt;f32&gt;,
    w_v: Array2&lt;f32&gt;,
}

impl AttentionLayer {
    fn new(d_model: usize, d_k: usize) -&gt; Self {
        // Inicializar pesos aleatoriamente
        Self {
            d_model,
            d_k,
            w_q: Array2::random((d_model, d_k), Uniform::new(-0.1, 0.1)),
            w_k: Array2::random((d_model, d_k), Uniform::new(-0.1, 0.1)),
            w_v: Array2::random((d_model, d_k), Uniform::new(-0.1, 0.1)),
        }
    }
    
    fn forward(&amp;self, x: &amp;Array2&lt;f32&gt;) -&gt; Array2&lt;f32&gt; {
        // Calcular Q, K, V
        let q = x.dot(&amp;self.w_q);
        let k = x.dot(&amp;self.w_k);
        let v = x.dot(&amp;self.w_v);
        
        // Calcular scores de atenção
        let scores = q.dot(&amp;k.t()) / (self.d_k as f32).sqrt();
        
        // Aplicar softmax
        let attention_weights = softmax(&amp;scores);
        
        // Aplicar atenção aos valores
        attention_weights.dot(&amp;v)
    }
}

fn softmax(x: &amp;Array2&lt;f32&gt;) -&gt; Array2&lt;f32&gt; {
    let mut result = x.clone();
    for mut row in result.axis_iter_mut(Axis(0)) {
        let max_val = row.fold(f32::NEG_INFINITY, |a, &amp;b| a.max(b));
        row.mapv_inplace(|x| (x - max_val).exp());
        let sum: f32 = row.sum();
        row /= sum;
    }
    result
}
</pre>
                </div>
            </div>
        </div>

        <div class="progress-indicator">
            <div class="progress-dot active" data-section="1"></div>
            <div class="progress-dot" data-section="2"></div>
            <div class="progress-dot" data-section="3"></div>
            <div class="progress-dot" data-section="4"></div>
            <div class="progress-dot" data-section="5"></div>
        </div>
    </div>

    <script>
        // Estado global
        let currentSection = 1;
        let currentTokens = [];
        let attentionWeights = [];
        let selectedToken = -1;
        let mathStep = 0;
        let qkvVectors = { Q: [], K: [], V: [] };

        // Navegação entre seções
        document.querySelectorAll('.path-step').forEach(step => {
            step.addEventListener('click', () => {
                const sectionNum = parseInt(step.dataset.step);
                showSection(sectionNum);
            });
        });

        function showSection(sectionNum) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar seção selecionada
            document.getElementById(`section-${sectionNum}`).classList.add('active');
            
            // Atualizar indicadores
            document.querySelectorAll('.path-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${sectionNum}"]`).classList.add('active');
            
            document.querySelectorAll('.progress-dot').forEach(dot => {
                dot.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionNum}"]`).classList.add('active');
            
            currentSection = sectionNum;
        }

        // Seção 1: Demonstração básica
        document.querySelectorAll('#basicDemo .token-item').forEach(token => {
            token.addEventListener('click', () => {
                const word = token.dataset.word;
                showBasicConnection(word);
                
                // Destacar token selecionado
                document.querySelectorAll('#basicDemo .token-item').forEach(t => t.classList.remove('selected'));
                token.classList.add('selected');
            });
        });

        function showBasicConnection(word) {
            const explanations = {
                'O': 'O artigo "O" presta atenção principalmente ao substantivo "gato" para determinar o gênero e número.',
                'gato': 'O substantivo "gato" é o sujeito da frase e presta atenção ao verbo "subiu" para entender a ação.',
                'subiu': 'O verbo "subiu" conecta o sujeito "gato" com o complemento "telhado" através da preposição.',
                'no': 'A preposição "no" liga o verbo "subiu" ao local "telhado", indicando direção.',
                'telhado': 'O substantivo "telhado" é o destino da ação e recebe atenção de "subiu" e "no".'
            };
            
            document.getElementById('basicExplanation').style.display = 'block';
            document.getElementById('connectionText').textContent = explanations[word];
        }

        // Seção 2: Matemática
        function generateRandomVectors() {
            const dim = 4; // Dimensão pequena para visualização
            const numTokens = 3;
            
            qkvVectors = {
                Q: Array.from({length: numTokens}, () => Array.from({length: dim}, () => Math.random() * 2 - 1)),
                K: Array.from({length: numTokens}, () => Array.from({length: dim}, () => Math.random() * 2 - 1)),
                V: Array.from({length: numTokens}, () => Array.from({length: dim}, () => Math.random() * 2 - 1))
            };
            
            mathStep = 0;
            displayMathVisualization();
        }

        function calculateAttentionStep() {
            mathStep++;
            displayMathVisualization();
        }

        function resetCalculation() {
            mathStep = 0;
            document.getElementById('mathVisualization').innerHTML = '<div class="empty-state">Clique em "Gerar Vetores Aleatórios" para começar</div>';
        }

        function displayMathVisualization() {
            const container = document.getElementById('mathVisualization');
            let html = '';
            
            if (mathStep === 0) {
                html = `
                    <div class="explanation-box">
                        <div class="explanation-title">Passo 1: Vetores Q, K, V Gerados</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                            <div>
                                <h4 style="color: #60a5fa;">Query (Q)</h4>
                                ${displayVector(qkvVectors.Q[0], 'blue')}
                            </div>
                            <div>
                                <h4 style="color: #34d399;">Key (K)</h4>
                                ${displayVector(qkvVectors.K[0], 'green')}
                            </div>
                            <div>
                                <h4 style="color: #a78bfa;">Value (V)</h4>
                                ${displayVector(qkvVectors.V[0], 'purple')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (mathStep === 1) {
                const dotProduct = qkvVectors.Q[0].reduce((sum, q, i) => sum + q * qkvVectors.K[0][i], 0);
                html += `
                    <div class="explanation-box">
                        <div class="explanation-title">Passo 2: Produto Escalar Q·K</div>
                        <div class="math-formula">Q·K = ${dotProduct.toFixed(3)}</div>
                        <p>Este valor representa a "compatibilidade" entre a query e a key.</p>
                    </div>
                `;
            } else if (mathStep === 2) {
                const dotProduct = qkvVectors.Q[0].reduce((sum, q, i) => sum + q * qkvVectors.K[0][i], 0);
                const scaled = dotProduct / Math.sqrt(qkvVectors.Q[0].length);
                html += `
                    <div class="explanation-box">
                        <div class="explanation-title">Passo 3: Escalonamento</div>
                        <div class="math-formula">Score = Q·K / √d_k = ${scaled.toFixed(3)}</div>
                        <p>Dividimos por √d_k para estabilizar os gradientes.</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function displayVector(vector, color) {
            return `
                <div class="vector-visualization">
                    ${vector.map(v => `<div class="vector-component" style="background: ${color}; opacity: ${Math.abs(v)}">${v.toFixed(2)}</div>`).join('')}
                </div>
            `;
        }

        // Seção 3: Visualização principal
        document.getElementById('modelDim').addEventListener('input', (e) => {
            document.getElementById('modelDimValue').textContent = `${e.target.value} dimensões`;
        });

        document.getElementById('temperature').addEventListener('input', (e) => {
            document.getElementById('temperatureValue').textContent = e.target.value;
        });

        document.getElementById('analyzeButton').addEventListener('click', () => {
            const text = document.getElementById('inputText').value.trim();
            if (!text) {
                alert('Por favor, insira um texto para analisar.');
                return;
            }
            
            analyzeAttention(text);
        });

        function analyzeAttention(text) {
            // Tokenizar
            currentTokens = text.split(/\s+/).map((token, i) => ({ text: token, id: i }));
            
            // Gerar vetores Q, K, V
            const dim = parseInt(document.getElementById('modelDim').value);
            qkvVectors = generateQKVVectors(currentTokens, dim);
            
            // Calcular atenção
            attentionWeights = computeAttentionMatrix(qkvVectors.Q, qkvVectors.K);
            
            // Atualizar visualizações
            displayTokens();
            displayAttentionMatrix();
        }

        function generateQKVVectors(tokens, dim) {
            const Q = [], K = [], V = [];
            
            for (let i = 0; i < tokens.length; i++) {
                Q.push(Array.from({length: dim}, () => Math.random() * 2 - 1));
                K.push(Array.from({length: dim}, () => Math.random() * 2 - 1));
                V.push(Array.from({length: dim}, () => Math.random() * 2 - 1));
            }
            
            return { Q, K, V };
        }

        function computeAttentionMatrix(Q, K) {
            const numTokens = Q.length;
            const dim = Q[0].length;
            const scale = 1 / Math.sqrt(dim);
            
            const scores = [];
            
            for (let i = 0; i < numTokens; i++) {
                const row = [];
                for (let j = 0; j < numTokens; j++) {
                    const score = Q[i].reduce((sum, q, k) => sum + q * K[j][k], 0) * scale;
                    row.push(score);
                }
                scores.push(softmax(row));
            }
            
            return scores;
        }

        function softmax(arr) {
            const max = Math.max(...arr);
            const exp = arr.map(x => Math.exp(x - max));
            const sum = exp.reduce((a, b) => a + b, 0);
            return exp.map(x => x / sum);
        }

        function displayTokens() {
            const container = document.getElementById('tokensDisplay');
            container.innerHTML = '';
            
            currentTokens.forEach((token, i) => {
                const tokenEl = document.createElement('div');
                tokenEl.className = 'token-item';
                tokenEl.textContent = token.text;
                tokenEl.addEventListener('click', () => selectToken(i));
                container.appendChild(tokenEl);
            });
        }

        function displayAttentionMatrix() {
            const container = document.getElementById('attentionMatrixContainer');
            const matrix = document.createElement('div');
            matrix.className = 'attention-matrix';
            matrix.style.gridTemplateColumns = `repeat(${currentTokens.length + 1}, 1fr)`;
            
            // Cabeçalho
            matrix.appendChild(document.createElement('div'));
            currentTokens.forEach(token => {
                const header = document.createElement('div');
                header.className = 'matrix-label';
                header.textContent = token.text;
                matrix.appendChild(header);
            });
            
            // Matriz
            attentionWeights.forEach((row, i) => {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'matrix-label';
                rowHeader.textContent = currentTokens[i].text;
                matrix.appendChild(rowHeader);
                
                row.forEach((weight, j) => {
                    const cell = document.createElement('div');
                    cell.className = 'attention-cell';
                    cell.style.backgroundColor = getAttentionColor(weight);
                    cell.textContent = weight.toFixed(2);
                    cell.addEventListener('click', () => showAttentionDetails(i, j, weight));
                    matrix.appendChild(cell);
                });
            });
            
            container.innerHTML = '';
            container.appendChild(matrix);
        }

        function getAttentionColor(weight) {
            const intensity = Math.floor(weight * 255);
            return `rgb(${59 + intensity}, ${130 + intensity/2}, ${246})`;
        }

        function selectToken(index) {
            selectedToken = index;
            
            // Atualizar seleção visual
            document.querySelectorAll('#tokensDisplay .token-item').forEach((el, i) => {
                el.classList.toggle('selected', i === index);
            });
            
            // Mostrar fluxo de atenção
            showAttentionFlow(index);
        }

        function showAttentionFlow(tokenIndex) {
            const container = document.getElementById('attentionFlow');
            
            if (attentionWeights.length === 0) {
                container.innerHTML = '<div class="empty-state">Analise um texto primeiro</div>';
                return;
            }
            
            const weights = attentionWeights[tokenIndex];
            const maxWeight = Math.max(...weights);
            
            const barsContainer = document.createElement('div');
            barsContainer.className = 'flow-bars';
            
            weights.forEach((weight, i) => {
                const barContainer = document.createElement('div');
                barContainer.className = 'flow-bar';
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${(weight / maxWeight) * 120}px`;
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = currentTokens[i].text;
                
                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = weight.toFixed(2);
                
                barContainer.appendChild(bar);
                barContainer.appendChild(label);
                barContainer.appendChild(value);
                barsContainer.appendChild(barContainer);
            });
            
            container.innerHTML = '';
            container.appendChild(barsContainer);
        }

        function showAttentionDetails(fromIndex, toIndex, weight) {
            const from = currentTokens[fromIndex].text;
            const to = currentTokens[toIndex].text;
            alert(`Atenção: "${from}" → "${to}" = ${weight.toFixed(3)}\n\nIsso significa que "${from}" presta ${(weight * 100).toFixed(1)}% de atenção a "${to}".`);
        }

        // Seção 4: Tipos de atenção
        function selectAttentionType(type) {
            const titles = {
                'self': '🔄 Self-Attention',
                'masked': '🎭 Masked Self-Attention',
                'cross': '🔀 Cross-Attention'
            };
            
            document.getElementById('demoTitle').textContent = titles[type];
            
            const container = document.getElementById('typeVisualization');
            container.innerHTML = `
                <div class="explanation-box">
                    <div class="explanation-title">Demonstração: ${titles[type]}</div>
                    <p>${getAttentionTypeExplanation(type)}</p>
                </div>
                <div class="interactive-demo">
                    <button class="btn btn-primary" onclick="demonstrateAttentionType('${type}')">🎯 Ver Exemplo</button>
                </div>
                <div id="typeExample"></div>
            `;
        }

        function getAttentionTypeExplanation(type) {
            const explanations = {
                'self': 'Cada palavra pode prestar atenção a qualquer outra palavra na frase, incluindo ela mesma. Isso permite capturar relações bidirecionais.',
                'masked': 'Cada palavra só pode prestar atenção às palavras que vêm antes dela. Isso é essencial para modelos generativos como GPT.',
                'cross': 'Palavras de uma sequência (ex: pergunta) prestam atenção a palavras de outra sequência (ex: contexto). Usado em tradução e Q&A.'
            };
            return explanations[type];
        }

        function demonstrateAttentionType(type) {
            // Implementar demonstração específica para cada tipo
            const container = document.getElementById('typeExample');
            container.innerHTML = `<div class="explanation-box">Demonstração de ${type} em desenvolvimento...</div>`;
        }

        // Seção 5: Prática
        document.getElementById('numHeads').addEventListener('input', (e) => {
            document.getElementById('numHeadsValue').textContent = `${e.target.value} cabeças`;
        });

        function loadExample(type) {
            const examples = {
                'simple': 'O gato subiu no telhado.',
                'complex': 'O gato preto que estava dormindo no jardim subiu rapidamente no telhado vermelho.',
                'ambiguous': 'O homem viu o menino com o telescópio.',
                'long': 'Era uma vez um gato muito esperto que vivia em uma casa antiga. Todos os dias ele subia no telhado para observar os pássaros que voavam pelo céu azul.'
            };
            
            document.getElementById('practiceText').value = examples[type];
        }

        document.getElementById('runExperiment').addEventListener('click', () => {
            const text = document.getElementById('practiceText').value.trim();
            if (!text) {
                alert('Por favor, insira um texto para experimentar.');
                return;
            }
            
            runExperiment(text);
        });

        function runExperiment(text) {
            const numHeads = parseInt(document.getElementById('numHeads').value);
            const attentionType = document.getElementById('attentionTypeSelect').value;
            
            // Simular experimento
            const results = {
                text: text,
                numHeads: numHeads,
                attentionType: attentionType,
                tokens: text.split(/\s+/).length,
                avgAttention: Math.random().toFixed(3),
                maxAttention: Math.random().toFixed(3)
            };
            
            displayExperimentResults(results);
        }

        function displayExperimentResults(results) {
            const container = document.getElementById('experimentResults');
            const content = document.getElementById('resultsContent');
            
            content.innerHTML = `
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">📊 Estatísticas</div>
                        <p><strong>Tokens:</strong> ${results.tokens}</p>
                        <p><strong>Cabeças:</strong> ${results.numHeads}</p>
                        <p><strong>Tipo:</strong> ${results.attentionType}</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">🎯 Atenção</div>
                        <p><strong>Média:</strong> ${results.avgAttention}</p>
                        <p><strong>Máxima:</strong> ${results.maxAttention}</p>
                    </div>
                </div>
                <div class="explanation-box">
                    <div class="explanation-title">💡 Insights</div>
                    <p>Com ${results.numHeads} cabeças de atenção, o modelo pode capturar ${results.numHeads} tipos diferentes de relações simultaneamente.</p>
                </div>
            `;
            
            container.style.display = 'block';
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            showSection(1);
        });
    </script>
</body>
</html>