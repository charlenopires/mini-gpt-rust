<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Função de Perda Cross-Entropy - Mini GPT Rust</title>
    <link rel="stylesheet" href="css/design-system.css">
    <style>
        .loss-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .loss-visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .prediction-panel {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }
        
        .prediction-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .panel-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .probability-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .probability-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .token-label {
            min-width: 80px;
            font-weight: 600;
            text-align: right;
        }
        
        .probability-bar {
            flex: 1;
            height: 25px;
            background: #f5f5f5;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .probability-fill {
            height: 100%;
            border-radius: 12px;
            transition: all 0.5s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .probability-fill.correct {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
        }
        
        .probability-fill.incorrect {
            background: linear-gradient(90deg, #2196f3, #64b5f6);
        }
        
        .probability-fill.target {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
            animation: pulse-target 2s infinite;
        }
        
        @keyframes pulse-target {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loss-calculation {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .loss-formula {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Times New Roman', serif;
            text-align: center;
            font-size: 1.2em;
        }
        
        .loss-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .loss-step {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .loss-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .step-number {
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
        }
        
        .step-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .step-value {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .control-panel {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .control-group {
            margin: 15px 0;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            min-width: 80px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .action-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .action-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .action-button.secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        .action-button.secondary:hover {
            background: #ccc;
        }
        
        .training-simulation {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .epoch-display {
            text-align: center;
            margin: 20px 0;
        }
        
        .epoch-counter {
            font-size: 2em;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .loss-chart {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 20px 0;
            height: 300px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .metric-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .comparison-section {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }
        
        .comparison-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .scenario-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .scenario-button {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .scenario-button:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .scenario-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .gradient-visualization {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .gradient-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        
        .arrow {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            transition: all 0.3s ease;
        }
        
        .arrow.down {
            border-top: 20px solid #4caf50;
        }
        
        .arrow.up {
            border-bottom: 20px solid #f44336;
        }
        
        .temperature-demo {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .temperature-title {
            color: #f57c00;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .highlight {
            background: linear-gradient(120deg, var(--primary-color)20, transparent);
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .math-explanation {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .math-title {
            color: #388e3c;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .loss-visualization {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .scenario-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="loss-container">
        <header class="hero-section">
            <h1>📊 Função de Perda Cross-Entropy</h1>
            <p class="hero-description">
                Entenda como a função de perda Cross-Entropy mede a diferença entre as predições do modelo 
                e os valores reais, guiando o processo de otimização durante o treinamento.
            </p>
        </header>

        <section class="concept-explanation">
            <h2>🔍 O que é Cross-Entropy Loss?</h2>
            <p>
                A <strong>Cross-Entropy Loss</strong> é uma função de perda amplamente usada em problemas de 
                classificação, especialmente em modelos de linguagem. Ela mede quão "surpreso" o modelo fica 
                com a resposta correta - quanto menor a probabilidade atribuída à resposta certa, maior a perda.
            </p>
            
            <div class="loss-formula">
                <strong>Fórmula da Cross-Entropy:</strong><br>
                L = -∑ yᵢ × log(ŷᵢ)<br>
                <small>onde yᵢ é o valor real (0 ou 1) e ŷᵢ é a probabilidade predita</small>
            </div>
        </section>

        <section class="loss-visualization">
            <div class="prediction-panel">
                <div class="panel-title">🎯 Predições do Modelo</div>
                <div class="probability-bars" id="predictions">
                    <!-- Será preenchido dinamicamente -->
                </div>
                <p><strong>Próximo token esperado:</strong> <span id="target-token" class="highlight">"mundo"</span></p>
            </div>
            
            <div class="prediction-panel">
                <div class="panel-title">📈 Cálculo da Perda</div>
                <div class="loss-steps" id="loss-steps">
                    <!-- Será preenchido dinamicamente -->
                </div>
                <div class="loss-formula">
                    <strong>Perda Total:</strong> <span id="total-loss">2.45</span>
                </div>
            </div>
        </section>

        <section class="control-panel">
            <h3>Simulação Interativa</h3>
            
            <div class="scenario-selector">
                <button class="scenario-button active" onclick="setScenario('good')">✅ Boa Predição</button>
                <button class="scenario-button" onclick="setScenario('poor')">❌ Predição Ruim</button>
                <button class="scenario-button" onclick="setScenario('random')">🎲 Aleatória</button>
                <button class="scenario-button" onclick="setScenario('confident')">💪 Muito Confiante</button>
            </div>
            
            <div class="control-group">
                <label>Temperatura (Suavização): <span id="temperature-value">1.0</span></label>
                <div class="slider-container">
                    <input type="range" id="temperature-slider" class="slider" min="0.1" max="2.0" step="0.1" value="1.0">
                    <div class="value-display" id="temperature-display">1.0</div>
                </div>
            </div>
            
            <button class="action-button" onclick="calculateLoss()">🔄 Recalcular Perda</button>
            <button class="action-button" onclick="startTraining()">🚀 Simular Treinamento</button>
            <button class="action-button secondary" onclick="resetDemo()">↩️ Reset</button>
        </section>

        <section class="training-simulation">
            <h2>🏋️ Simulação de Treinamento</h2>
            
            <div class="epoch-display">
                <div>Época: <span class="epoch-counter" id="epoch-counter">0</span></div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="current-loss">2.45</div>
                    <div class="metric-label">Perda Atual</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-loss">2.45</div>
                    <div class="metric-label">Perda Média</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="accuracy">25%</div>
                    <div class="metric-label">Precisão</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="perplexity">11.6</div>
                    <div class="metric-label">Perplexidade</div>
                </div>
            </div>
            
            <canvas id="loss-chart" class="loss-chart" width="800" height="250"></canvas>
        </section>

        <section class="comparison-section">
            <h2>⚖️ Comparação de Cenários</h2>
            
            <div class="comparison-grid">
                <div class="comparison-item">
                    <div class="comparison-title">🎯 Modelo Bem Treinado</div>
                    <div class="probability-bars">
                        <div class="probability-item">
                            <span class="token-label">"mundo"</span>
                            <div class="probability-bar">
                                <div class="probability-fill correct" style="width: 85%;">85%</div>
                            </div>
                        </div>
                        <div class="probability-item">
                            <span class="token-label">"casa"</span>
                            <div class="probability-bar">
                                <div class="probability-fill incorrect" style="width: 8%;">8%</div>
                            </div>
                        </div>
                        <div class="probability-item">
                            <span class="token-label">"vida"</span>
                            <div class="probability-bar">
                                <div class="probability-fill incorrect" style="width: 7%;">7%</div>
                            </div>
                        </div>
                    </div>
                    <div class="loss-formula">
                        <strong>Perda:</strong> 0.16 (Baixa ✅)
                    </div>
                </div>
                
                <div class="comparison-item">
                    <div class="comparison-title">❌ Modelo Mal Treinado</div>
                    <div class="probability-bars">
                        <div class="probability-item">
                            <span class="token-label">"mundo"</span>
                            <div class="probability-bar">
                                <div class="probability-fill target" style="width: 15%;">15%</div>
                            </div>
                        </div>
                        <div class="probability-item">
                            <span class="token-label">"casa"</span>
                            <div class="probability-bar">
                                <div class="probability-fill incorrect" style="width: 45%;">45%</div>
                            </div>
                        </div>
                        <div class="probability-item">
                            <span class="token-label">"vida"</span>
                            <div class="probability-bar">
                                <div class="probability-fill incorrect" style="width: 40%;">40%</div>
                            </div>
                        </div>
                    </div>
                    <div class="loss-formula">
                        <strong>Perda:</strong> 1.90 (Alta ❌)
                    </div>
                </div>
            </div>
        </section>

        <section class="math-explanation">
            <div class="math-title">
                🧮 Detalhes Matemáticos
            </div>
            
            <h3>Cálculo Passo a Passo</h3>
            <div class="loss-formula">
                <strong>1. Softmax (Normalização):</strong><br>
                ŷᵢ = exp(zᵢ/T) / ∑ⱼ exp(zⱼ/T)<br>
                <small>onde T é a temperatura</small>
            </div>
            
            <div class="loss-formula">
                <strong>2. Cross-Entropy:</strong><br>
                L = -log(ŷₜₐᵣgₑₜ)<br>
                <small>onde ŷₜₐᵣgₑₜ é a probabilidade do token correto</small>
            </div>
            
            <div class="loss-formula">
                <strong>3. Gradiente:</strong><br>
                ∂L/∂zᵢ = ŷᵢ - yᵢ<br>
                <small>diferença entre predição e valor real</small>
            </div>
        </section>

        <section class="temperature-demo">
            <div class="temperature-title">
                🌡️ Efeito da Temperatura
            </div>
            
            <p>
                A <strong>temperatura</strong> controla a "confiança" das predições:
            </p>
            
            <ul>
                <li><strong>T < 1:</strong> Predições mais confiantes (distribuição mais concentrada)</li>
                <li><strong>T = 1:</strong> Predições normais</li>
                <li><strong>T > 1:</strong> Predições mais uniformes (distribuição mais suave)</li>
            </ul>
            
            <div class="gradient-visualization">
                <div>Temperatura Baixa (T=0.5)</div>
                <div class="probability-bars">
                    <div class="probability-item">
                        <span class="token-label">"mundo"</span>
                        <div class="probability-bar">
                            <div class="probability-fill correct" style="width: 95%;">95%</div>
                        </div>
                    </div>
                </div>
                
                <div class="gradient-arrow">
                    <div class="arrow down"></div>
                </div>
                
                <div>Temperatura Alta (T=2.0)</div>
                <div class="probability-bars">
                    <div class="probability-item">
                        <span class="token-label">"mundo"</span>
                        <div class="probability-bar">
                            <div class="probability-fill target" style="width: 40%;">40%</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="implementation-details">
            <h2>💻 Implementação em Rust</h2>
            
            <div class="math-explanation">
                <div class="math-title">
                    🦀 Código Rust
                </div>
                
                <div class="loss-formula" style="text-align: left; font-family: 'Courier New', monospace;">
                    <strong>fn cross_entropy_loss(</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;predictions: &Tensor,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;targets: &Tensor,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;temperature: f32<br>
                    <strong>) -> f32 {</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;// Aplicar temperatura<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;let scaled = predictions / temperature;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;// Softmax<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;let softmax = scaled.softmax(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;// Cross-entropy<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;-softmax.log().mul(targets).sum()<br>
                    <strong>}</strong>
                </div>
            </div>
        </section>
    </div>

    <script>
        let currentScenario = 'good';
        let currentTemperature = 1.0;
        let trainingRunning = false;
        let currentEpoch = 0;
        let lossHistory = [];
        
        // Elementos DOM
        const temperatureSlider = document.getElementById('temperature-slider');
        const lossChart = document.getElementById('loss-chart');
        const ctx = lossChart.getContext('2d');
        
        // Dados de exemplo
        const scenarios = {
            good: {
                predictions: [0.85, 0.08, 0.07],
                tokens: ['mundo', 'casa', 'vida'],
                target: 0
            },
            poor: {
                predictions: [0.15, 0.45, 0.40],
                tokens: ['mundo', 'casa', 'vida'],
                target: 0
            },
            random: {
                predictions: [0.33, 0.33, 0.34],
                tokens: ['mundo', 'casa', 'vida'],
                target: 0
            },
            confident: {
                predictions: [0.98, 0.01, 0.01],
                tokens: ['mundo', 'casa', 'vida'],
                target: 0
            }
        };
        
        // Event listeners
        temperatureSlider.addEventListener('input', (e) => {
            currentTemperature = parseFloat(e.target.value);
            document.getElementById('temperature-display').textContent = currentTemperature.toFixed(1);
            updateVisualization();
        });
        
        function setScenario(scenario) {
            currentScenario = scenario;
            
            // Atualizar botões
            document.querySelectorAll('.scenario-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateVisualization();
        }
        
        function applyTemperature(logits, temperature) {
            const scaledLogits = logits.map(l => l / temperature);
            const maxLogit = Math.max(...scaledLogits);
            const expLogits = scaledLogits.map(l => Math.exp(l - maxLogit));
            const sumExp = expLogits.reduce((a, b) => a + b, 0);
            return expLogits.map(e => e / sumExp);
        }
        
        function calculateCrossEntropy(predictions, targetIndex) {
            const targetProb = predictions[targetIndex];
            return -Math.log(Math.max(targetProb, 1e-10)); // Evita log(0)
        }
        
        function updateVisualization() {
            const scenario = scenarios[currentScenario];
            
            // Simular logits originais (para aplicar temperatura)
            const originalLogits = scenario.predictions.map(p => Math.log(p + 1e-10));
            const adjustedProbs = applyTemperature(originalLogits, currentTemperature);
            
            // Atualizar barras de probabilidade
            const predictionsContainer = document.getElementById('predictions');
            predictionsContainer.innerHTML = '';
            
            adjustedProbs.forEach((prob, i) => {
                const item = document.createElement('div');
                item.className = 'probability-item';
                
                const isTarget = i === scenario.target;
                const fillClass = isTarget ? 'target' : 'incorrect';
                
                item.innerHTML = `
                    <span class="token-label">"${scenario.tokens[i]}"</span>
                    <div class="probability-bar">
                        <div class="probability-fill ${fillClass}" style="width: ${prob * 100}%;">
                            ${(prob * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
                
                predictionsContainer.appendChild(item);
            });
            
            // Calcular e mostrar perda
            const loss = calculateCrossEntropy(adjustedProbs, scenario.target);
            
            // Atualizar steps de cálculo
            const stepsContainer = document.getElementById('loss-steps');
            stepsContainer.innerHTML = `
                <div class="loss-step">
                    <div class="step-number">1</div>
                    <div class="step-title">Probabilidade</div>
                    <div class="step-value">${(adjustedProbs[scenario.target] * 100).toFixed(1)}%</div>
                </div>
                <div class="loss-step">
                    <div class="step-number">2</div>
                    <div class="step-title">Logaritmo</div>
                    <div class="step-value">${Math.log(adjustedProbs[scenario.target]).toFixed(3)}</div>
                </div>
                <div class="loss-step">
                    <div class="step-number">3</div>
                    <div class="step-title">Negativo</div>
                    <div class="step-value">${(-Math.log(adjustedProbs[scenario.target])).toFixed(3)}</div>
                </div>
            `;
            
            // Atualizar perda total
            document.getElementById('total-loss').textContent = loss.toFixed(3);
            document.getElementById('current-loss').textContent = loss.toFixed(3);
            
            // Atualizar métricas
            const accuracy = adjustedProbs[scenario.target] > 0.5 ? 100 : 0;
            const perplexity = Math.exp(loss);
            
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('perplexity').textContent = perplexity.toFixed(1);
        }
        
        function calculateLoss() {
            updateVisualization();
            
            // Animação de recálculo
            const lossSteps = document.querySelectorAll('.loss-step');
            lossSteps.forEach((step, i) => {
                setTimeout(() => {
                    step.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        step.style.transform = 'scale(1)';
                    }, 200);
                }, i * 100);
            });
        }
        
        function startTraining() {
            if (trainingRunning) return;
            
            trainingRunning = true;
            currentEpoch = 0;
            lossHistory = [];
            
            const trainingInterval = setInterval(() => {
                currentEpoch++;
                
                // Simular melhoria gradual
                const improvementFactor = Math.exp(-currentEpoch * 0.1);
                const baseLoss = 2.5;
                const targetLoss = 0.1;
                const currentLoss = targetLoss + (baseLoss - targetLoss) * improvementFactor;
                
                lossHistory.push(currentLoss);
                
                // Atualizar display
                document.getElementById('epoch-counter').textContent = currentEpoch;
                document.getElementById('current-loss').textContent = currentLoss.toFixed(3);
                
                const avgLoss = lossHistory.reduce((a, b) => a + b, 0) / lossHistory.length;
                document.getElementById('avg-loss').textContent = avgLoss.toFixed(3);
                
                // Atualizar gráfico
                drawLossChart();
                
                // Parar após 50 épocas
                if (currentEpoch >= 50) {
                    clearInterval(trainingInterval);
                    trainingRunning = false;
                }
            }, 200);
        }
        
        function drawLossChart() {
            ctx.clearRect(0, 0, lossChart.width, lossChart.height);
            
            if (lossHistory.length < 2) return;
            
            const margin = 40;
            const chartWidth = lossChart.width - 2 * margin;
            const chartHeight = lossChart.height - 2 * margin;
            
            // Eixos
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, margin + chartHeight);
            ctx.lineTo(margin + chartWidth, margin + chartHeight);
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, margin + chartHeight);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Épocas', margin + chartWidth/2, margin + chartHeight + 30);
            
            ctx.save();
            ctx.translate(15, margin + chartHeight/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('Perda', 0, 0);
            ctx.restore();
            
            // Linha da perda
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const maxLoss = Math.max(...lossHistory);
            const minLoss = Math.min(...lossHistory);
            const lossRange = maxLoss - minLoss || 1;
            
            lossHistory.forEach((loss, i) => {
                const x = margin + (i / (lossHistory.length - 1)) * chartWidth;
                const y = margin + chartHeight - ((loss - minLoss) / lossRange) * chartHeight;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }
        
        function resetDemo() {
            currentEpoch = 0;
            lossHistory = [];
            trainingRunning = false;
            
            document.getElementById('epoch-counter').textContent = '0';
            ctx.clearRect(0, 0, lossChart.width, lossChart.height);
            
            updateVisualization();
        }
        
        // Inicialização
        updateVisualization();
    </script>
</body>
</html>